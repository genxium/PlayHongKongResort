String.prototype.format=function(){var c=this;for(var a=0;a<arguments.length;a++){var b=new RegExp("\\{"+a+"\\}","gi");c=c.replace(b,arguments[a])}return c};var RELATION_NAMES={applied:"已報名",selected:"被選上啦",present:"與席",absent:"缺席",assessed:"已評價",hosted:""};var STATUS_NAMES={created:"已創建",pending:"等待審核",rejected:"未通過審核",accepted:"已通過審核"};var TITLES={logo_alias:"一起玩吧",all:"全部",unread:"未讀",read:"已讀",back:"返回",create:"創建",profile:"個人",register:"註冊帳號",login:"登入",logout:"登出",forgot_password:"忘記密碼",upload:"上傳",choose_picture:"選擇圖片",edit:"編輯",del:"刪除",update:"更新",save:"保存",submit:"提交",cancel:"取消",detail:"詳情",view:"詳細",join:"報名",begin_time:"開始時間",deadline:"報名截止",selected:"選中",applied:"報名",yes:"是",no:"否",submit_comment_question:"提交問題",submit_comment_reply:"提交",collapse:"收起",reply:"回覆",replied_to:"對@{0}: ",time_ascendant:"時間順序",time_descendant:"時間倒序",joined_activities:"參與的活動",hosted_activities:"發起的活動",question:"Q & A",participant:"參與者",assessment:"評價",view_assessment:"查看Ta收到的評價 >",assessment_disabled:"不可用",present:"已出席",absent:"未出席",from:"來自",content:"內容",by_host:"由 @{0} 發起",view_all_replies:"查看全部回覆({0})",about_us:"關於我們",contact_us:"聯絡我們",privacy_policy:"隱私聲明",resend_email_verification:"重發驗證郵件",submit_participant_selection:"提交",new_password:"新密碼",confirm_new_password:"確認新密碼",input_to_reset_password:"請輸入新密碼並提交以完成修改",add_image:"+",send:"發送",check_all:"全選",uncheck_all:"清空已選",ascendant:"順序",descendant:"倒序",automatic:"自動",time:"時間",last_accepted_time:"審核完成時間",defaulted:"默認",age:"年齡",gender:"性別",mood:"心情",first_foreign_party_registration:"這是你的首次登入, 請填寫一個用戶名以完成註冊, 同時建議填寫電郵地址",first_foreign_party_registration_qq:"Hi, <span class='highlight'>QQ</span>用戶<span class='highlight'>{0}</span>, 這是你的首次登入, 請填寫一個用戶名以完成註冊, 同時建議填寫電郵地址"};var MESSAGES={saving:"正在保存...",saved:"已保存",save_failed:"保存失敗",uploading:"正在上傳...",uploaded:"上傳成功",upload_failed:"上傳失敗",delete_activity_confirmation:"確定要刪除此活動嗎？",playername_requirement:"用戶名需為6-32位由英文字母， 數字或符號'_'組成",playername_valid:"此用戶名可以使用",playername_invalid:"此用戶名已被佔用",email_valid:"此電郵地址可以使用",email_invalid:"此電郵地址已被佔用",email_requirement:"請填寫有效的電郵地址",password_requirement:"密碼需為6~32位由英文字母，數字或符號'#'，'_'及'!'組成",password_confirm_requirement:"密碼不匹配",comment_reply_not_submitted:"回覆未提交",assessment_requirement:"請填寫0～64個字",age_requirement:"請填寫0～16個字",gender_requirement:"請填寫0～16個字",mood_requirement:"請填寫0～64個字",comment_disabled_activity_has_begun:"Q&A時間已經結束",comment_disabled_activity_not_accepted:"活動尚未通過審核",email_verification_success:"Hi @{0}， 你的電郵地址{1}已完成驗證， {2}秒後將為你跳轉到首頁",email_verification_failure:"Hi @{0}， 很遺憾你的電郵地址{1}未能通過驗證， 如需幫助請與{2}聯繫",about_us:"關於我們\n\r\n\r仲未寫",privacy_policy:"隱私聲明\n\r\n\r仲未寫",please_wait:"請稍後...",email_verification_sent:"驗證郵件已發送到你的註冊郵箱{0}, 請查收",email_verification_not_sent:"未能成功發送驗證郵件, 請重試",image_selection_requirement:"請選擇不多於3張圖片輔助活動說明, 每張圖片應不超過2MB(2048KB), 如需編輯或壓縮圖片可以使用<a target='_blank' href='http://www.pixlr.com'>Pixlr</a>",activity_created:"活動已創建, 你可以在個人主頁查看相關信息",activity_saved:"更新已保存",activity_not_saved:"保存不成功",activity_saving:"正在保存...",instructions_sent_to:"密碼重設郵件已發送至{0}, 請查收",instructions_not_sent:"郵件發送失敗， 請重試",password_reset_tips:"請輸入你的註冊電郵地址",notice:"請注意",password_reset_notice_1:"若電郵地址未在本站註冊， 你將無法收到所需郵件",password_reset_notice_2:"若電郵地址不存在， 你將無法收到所需郵件",password_reset_notice_3:"電郵地址所關聯帳號在申請密碼重設期間不會失效， 如需凍結帳號請通過<a href=\"mailto:admin@qiutongqu.com?subject='account suspension'\">admin@qiutongqu.com</a>聯繫我們",qq_welcome:"歡迎回來, <span class='highlight'>QQ</span>用戶<span class='highlight'>{0}</span>"};var HINTS={playername:"用戶名",email:"電郵地址",password:"密碼",confirm_password:"確認密碼",title:"標題",address:"地址",content:"內容",activity_title:"標題",activity_address:"活動地點",activity_content:"活動內容",captcha:"驗證碼",reply:"對@{0}說: "};var ALERTS={captcha_not_matched:"驗證碼錯誤",creation_limit_exceeded:"創建活動太頻繁囉， 請稍後片刻",applicant_num_exceeded:"報名人數已達到上限",selected_num_exceeded:"已選人數已達到上限",deadline_expired:"報名已截止",image_selection_limit_exceeded:"請選擇{0}張以內圖片",invalid_email_format:"無效的電郵地址",wrong_password:"密碼錯誤",player_not_existing:"用戶不存在",comment_requirement:"請填寫5～128個字",comment_question_not_submitted:"問題未提交",registered:"註冊成功",not_registered:"註冊不成功",not_permitted_to_view_detail:"你無權瀏覽此頁",activity_not_begun:"活動尚未開始",assessment_submitted:"評價已成功提交",assessment_not_submitted:"評價未提交",no_assessment:"Oops! 暫時沒有人給Ta留下評價喔",choose_one_image:"一次只能選擇一張圖片",please_log_in:"請先登入",image_selection_requirement:"請選擇不多於3張圖片輔助活動說明, 每張圖片應不超過2MB(2048KB)",deadline_behind_begin_time:"報名截止時間應在活動開始時間之前",please_follow_activity_field_instructions:"請根據字數要求填寫各項",not_updated:"更新不成功",email_not_authenticated:"註冊郵箱尚未完成驗證無法進行此操作， 如未收到驗證郵件請在個人主頁點擊重新發送",invalid_image_type:"圖片類型應為jpg, jpeg或png",player_not_found:"未找到用戶記錄",relogin_required:"請重新登入",participant_selection_not_submitted:"參與者選擇未提交",unknown_error:"未知錯誤"};var g_numItemsPerPage=6;var g_baseTwo=2;var g_baseTen=10;var g_rootElement=$(":root");var g_inf=(1<<53);var g_orderDescend=(-1);var g_orderAscend=(+1);var g_directionForward=(+1);var g_directionBackward=(-1);var g_modeHomepage=0;var g_modeProfile=1;var g_adminEmail="admin@qiutongqu.com";var g_idKeyboardEnter=13;var g_keyToken="token";var g_keyAccessToken="access_token";var g_keyParty="party";var g_keyPartyNickname="party_nickname";var g_keyId="id";var g_keyOrderKey="order_key";var g_keyRelation="relation";var g_keyBundle="bundle";var g_keyRet="ret";var g_keyCount="count";var g_keyData="data";var g_keyPlayer="player";var g_keyCode="code";var g_keyPlayerId="player_id";var g_keyVieweeId="viewee_id";var g_keyName="name";var g_keyEmail="email";var g_keyPassword="password";var g_keyAvatar="avatar";var g_keyPasswordResetCode="password_reset_code";var g_keyUnreadCount="unread_count";var g_keyUnassessedCount="unassessed_count";var g_keyAge="age";var g_keyGender="gender";var g_keyMood="mood";var g_keyButton="button";var g_keyActivities="activities";var g_keyActivity="activity";var g_keyActivityId="activity_id";var g_keyTitle="title";var g_keyAddress="address";var g_keyContent="content";var g_keyCreatedTime="created_time";var g_keyBeginTime="begin_time";var g_keyDeadline="application_deadline";var g_keyImages="images";var g_keyStatus="status";var g_keyHostId="host_id";var g_keyHostName="host_name";var g_keyPriority="priority";var g_keyOrderMask="order_mask";var g_keyAppliedParticipants="applied_participants";var g_keySelectedParticipants="selected_participants";var g_keyPresentParticipants="present_participants";var g_keyAbsentParticipants="absent_participants";var g_keyImageId="image_id";var g_keyUrl="url";var g_keyComment="comment";var g_keyCommentId="comment_id";var g_keyParentId="parent_id";var g_keyPredecessorId="predecessor_id";var g_keyCommentType="type";var g_keyGeneratedTime="generated_time";var g_keyComments="comments";var g_keySubComments="sub_comments";var g_keyFrom="from";var g_keyFromName="from_name";var g_keyTo="to";var g_keyToName="to_name";var g_keyNotification="notification";var g_keyNotifications="notifications";var g_keyIsRead="is_read";var g_keyTag="tag";var g_keyState="state";var g_keyCbfunc="cbfunc";var g_keyArgs="args";var g_keyParams="params";var g_keyPage="page";var g_keyPageSt="page_st";var g_keyPageEd="page_ed";var g_keyRefIndex="ref_index";var g_keyNumItems="num_items";var g_keyOrder="order";var g_keyOrientation="orientation";var g_keyDirection="direction";var g_keyCell="cell";var g_keySid="sid";var g_keyCaptcha="captcha";var g_statusCreated=0;var g_statusPending=1;var g_statusRejected=2;var g_statusAccepted=3;var g_maxApplied=500;var g_maxSelected=250;var g_emailPattern=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i;var g_passwordPattern=/^[0-9a-zA-Z_#\\!]{6,32}$/;var g_playernamePattern=/^[0-9a-zA-Z_]{6,32}$/;var g_playerAgePattern=/^.{0,16}$/;var g_playerGenderPattern=/^.{0,16}$/;var g_playerMoodPattern=/^.{0,64}$/;var g_activityTitlePattern=/^.{5,64}$/;var g_activityAddressPattern=/^.{5,128}$/;var g_activityContentPattern=/^[\s\S]{15,1024}$/;var g_commentContentPattern=/^.{5,128}$/;var g_assessmentContentPattern=/^.{0,64}$/;var g_errNotLoggedIn=1001;var g_errPlayerNotFound=1003;var g_errPswErr=1004;var g_errDuplicated=1006;var g_errActivityHasBegun=3007;var g_errActivityAppliedLimit=3008;var g_errActivitySelectedLimit=3009;var g_errActivityCreationLimit=3010;var g_errCaptcha=4001;var g_errForeignPartyRegistrationRequired=5001;var g_errTempForeignPartyRecordNotFound=5002;var g_theme="main";var g_partyQQ=1;var g_appIdQQ=101239106;var g_keyDomain="domain";var g_keyRemoteName="remote_name";var g_keyUptoken="uptoken";var g_keyFileref="fileref";var g_cdnQiniu=1;function setCookie(c,e,d,f){if(!d){var d="/"}var a=null;if(!(!f)){var b=new Date();b.setTime(b.getTime()+(f*24*60*60*1000));a="; expires="+b.toGMTString()}else{a=""}document.cookie=c+"="+e+a+"; path="+d}function getCookie(a){if(document.cookie.length<=0){return null}var b=document.cookie.indexOf(a+"=");if(b==-1){return null}if(b-1>=0&&(document.cookie[b-1]!=" "&&document.cookie[b-1]!=";")){return null}b=b+a.length+1;end=document.cookie.indexOf(";",b);if(end==-1){end=document.cookie.length}return unescape(document.cookie.substring(b,end))}function removeCookie(a){setCookie(a,"","/",-1)}Function.prototype.method=function(a,b){this.prototype[a]=b;return this};Function.method("inherits",function(b){this.prototype=new b();var e={},c=this.prototype;this.prototype.constructor=b;this.method("uber",function a(g){if(!(g in e)){e[g]=0}var j,i,h=e[g],d=b.prototype;if(h){while(h){d=d.constructor.prototype;h-=1}j=d[g]}else{j=c[g];if(j==this[g]){j=d[g]}}e[g]+=1;i=j.apply(this,Array.prototype.slice.apply(arguments,[1]));e[g]-=1;return i});return this});Function.method("swiss",function(c){for(var b=1;b<arguments.length;b+=1){var a=arguments[b];this.prototype[a]=c.prototype[a]}return this});function callbackOnPageLoaded(c,a){if(a===null){return}var b=false;c.onload=c.onreadystatechange=function(){var d=(this.readyState===null||this.readyState=="complete");if(b||!d){return}b=true;a()}}function loadJavaScript(d,f,i){var g=d.document;if(g===null){return}var c=g.createElement("script");var b=g.createTextNode(f);c.appendChild(b);if(i!==null){var a=false;c.onload=c.onreadystatechange=function(){var j=(this.readyState===null||this.readyState=="complete");if(a||!j){return}a=true;i()}}var h=g.getElementsByTagName("head");if(h===null){return}var e=h[0];if(e===null){return}e.appendChild(c)}function loadScriptFile(g,h,e,a){var d=null;if(e=="js"){d=g.document.createElement("script");d.setAttribute("type","text/javascript");d.setAttribute("src",h)}else{if(e=="css"){d=g.document.createElement("link");d.setAttribute("rel","stylesheet");d.setAttribute("type","text/css");d.setAttribute("href",h)}else{}}if(typeof d=="undefined"){return}if(a!==null){var c=false;scriptNode.onload=scriptNode.onreadystatechange=function(){var i=(this.readyState===null||this.readyState=="complete");if(c||!i){return}c=true;a()}}var f=g.document.getElementsByTagName("head");if(f===null){return}var b=f[0];if(b===null){return}b.appendChild(d)}function validateEmail(a){var b=g_emailPattern;return b.test(a)}function validatePassword(a){var b=g_passwordPattern;return b.test(a)}function validateName(a){var b=g_playernamePattern;return b.test(a)}function validatePlayerAge(a){var b=g_playerAgePattern;return b.test(a)}function validatePlayerGender(a){var b=g_playerGenderPattern;return b.test(a)}function validatePlayerMood(b){var a=g_playerMoodPattern;return a.test(b)}function validateActivityTitle(b){var a=g_activityTitlePattern;return a.test(b)}function validateActivityAddress(a){var b=g_activityAddressPattern;return b.test(a)}function validateActivityContent(b){var a=g_activityContentPattern;return a.test(b)}function validateCommentContent(b){var a=g_commentContentPattern;return a.test(b)}function validateAssessmentContent(b){var a=g_assessmentContentPattern;return a.test(b)}function extractTagAndParams(b){var f=/https?:\/\/(.+)#(default|profile|detail|home|search|notifications|success|failure|access_token=[\w\d]+)\??\&?(.*)/i;var c=f.exec(b);if(c===null){return null}var h={};var j=c[2];var i=/(\w+)=([@\.\w]+)/g;var a=i.exec(j);if(a!==null){j={};j[a[1]]=a[2]}h[g_keyTag]=j;h[g_keyParams]={};var e=decodeURIComponent(c[3]);var d=/(\w+)=([:,\[\]{}"@\.\w]+)/g;var g=d.exec(e);while(g!==null){h[g_keyParams][g[1]]=g[2];g=d.exec(e)}return h}function firstChild(b,a){return $(b.children(a)[0])}function truncateMillisec(a){try{var c=a.split(".");if(c.length<=1){throw"oops!"}return c[0]}catch(b){return a}}function getCurrentYmdhisDate(){var b=new Date();var a=b.getFullYear().toString()+"-"+(b.getMonth()+1).toString()+"-"+b.getDate().toString();var c=b.getHours().toString()+":"+b.getMinutes().toString()+":"+b.getSeconds().toString();return a+" "+c}function compareYmdhisDate(q,o){var h=[];var b=[];var e=q.split(" ");var d=e[0].split("-");var m=e[1].split(":");for(var p in d){h.push(parseInt(d[p]))}for(var l in m){h.push(parseInt(m[l]))}var c=o.split(" ");var a=c[0].split("-");var k=c[1].split(":");for(var j in a){b.push(parseInt(a[n]))}for(var g in k){b.push(parseInt(k[n]))}for(var f=0;f<h.length;f++){if(h[f]<b[f]){return -1}if(h[f]>b[f]){return +1}}return 0}function getTarget(a){return $(a.srcElement?a.srcElement:a.target)}function isChecked(a){return(a!==null&&a.is(":checked"))}function isHidden(a){return(a!==null&&a.is(":hidden"))}function checkField(a){if(a===null){return}a.prop("checked",true)}function uncheckField(a){if(a===null){return}a.prop("checked",false)}function disableField(a){if(a===null){return}a.prop("disabled",true)}function enableField(a){if(a===null){return}a.prop("disabled",false)}function setMargin(e,d,c,b,a){if(e===null){return}if(d!==null){e.css("margin-left",d)}if(c!==null){e.css("margin-top",c)}if(b!==null){e.css("margin-right",b)}if(a!==null){e.css("margin-bottom",a)}}function setBackgroundImageDefault(b,a){if(b===null){return}setBackgroundImage(b,a,"contain","no-repeat","center")}function setBackgroundImage(e,b,c,d,a){if(e===null){return}e.css("background-image","url("+b+")");e.css("background-size",c);e.css("-o-background-size",c);e.css("-moz-background-size",c);e.css("-webkit-background-size",c);e.css("background-repeat",d);e.css("background-position",a)}function setDimensions(c,b,a){if(c===null){return}if(b!==null){c.css("width",b)}else{c.css("width","auto")}if(a!==null){c.css("height",a)}else{c.css("height","auto")}}function getDimensions(a){if(a===null){return{width:"0px",height:"0px"}}return{width:a.css("width"),height:a.css("height")}}function setOffset(c,b,a){if(c===null){return}if(b!==null){c.css("left",b)}else{c.css("left","auto")}if(a!==null){c.css("top",a)}else{c.css("top","auto")}}function getOffset(a){if(a===null){return{left:"0px",top:"0px"}}return{left:parseFloat(a.css("left")),top:parseFloat(a.css("top"))}}function stencilize(a){if(a===null){return}a.css("background-color","DimGray");a.css("color","Gainsboro")}function isFileValid(b){if(b===null){return false}var a=(1<<21);if(b.size>a){return false}return true}function validateImage(b){if(!b){return false}if(!isFileValid(b)){return false}var a=b.type;var c=a.split("/").pop().toLowerCase();if(!c){return false}if($.inArray(c,["png","jpg","jpeg"])==-1){alert(ALERTS.invalid_image_type);return false}return true}function currentMillis(){var a=new Date();return 1000*moment().utcOffset(a.getTimezoneOffset()).unix()}function gmtMiilisecToLocalYmdhis(b){var a=new Date();return moment(b).utcOffset(a.getTimezoneOffset()).format("YYYY-MM-DD HH:mm:ss")}function gmtMiilisecToLocalYmdhi(b){var a=new Date();return moment(b).utcOffset(a.getTimezoneOffset()).format("YYYY-MM-DD HH:mm")}function localYmdhisToGmtMillisec(a){var b=new Date();return 1000*moment(a,"YYYY-MM-DD HH:mm:ss").utcOffset(b.getTimezoneOffset()).unix()}function generateUuid(){function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function isStandardSuccess(b){if(b===null){return false}if(!b.hasOwnProperty(g_keyRet)){return false}var a=parseInt(b[g_keyRet]);return a===0}function isStandardFailure(b){if(b===null){return false}if(!b.hasOwnProperty(g_keyRet)){return false}var a=parseInt(b[g_keyRet]);return a==1}function isCaptchaNotMatched(b){if(b===null){return false}if(!b.hasOwnProperty(g_keyRet)){return false}var a=parseInt(b[g_keyRet]);return a==g_errCaptcha}function isTokenExpired(b){if(b===null){return false}if(!b.hasOwnProperty(g_keyRet)){return false}var a=parseInt(b[g_keyRet]);return a==g_errNotLoggedIn}function isPlayerNotFound(b){if(b===null){return false}if(!b.hasOwnProperty(g_keyRet)){return false}var a=parseInt(b[g_keyRet]);return a==g_errPlayerNotFound}function isPswErr(b){if(b===null){return false}if(!b.hasOwnProperty(g_keyRet)){return false}var a=parseInt(b[g_keyRet]);return a==g_errPswErr}function isDuplicated(b){if(!b){return false}if(!b.hasOwnProperty(g_keyRet)){return false}var a=parseInt(b[g_keyRet]);return a==g_errDuplicated}function isApplicantLimitExceeded(b){if(!b){return false}if(!b.hasOwnProperty(g_keyRet)){return false}var a=parseInt(b[g_keyRet]);return a==g_errActivityAppliedLimit}function isSelectedLimitExceeded(b){if(!b){return false}if(!b.hasOwnProperty(g_keyRet)){return false}var a=parseInt(b[g_keyRet]);return a==g_errActivitySelectedLimit}function isCreationLimitExceeded(b){if(!b){return false}if(!b.hasOwnProperty(g_keyRet)){return false}var a=parseInt(b[g_keyRet]);return a==g_errActivityCreationLimit}function isForeignPartyRegistrationRequired(b){if(!b){return false}if(!b.hasOwnProperty(g_keyRet)){return false}var a=parseInt(b[g_keyRet]);return a==g_errForeignPartyRegistrationRequired}function isTempForeignPartyRecordNotFound(b){if(!b){return false}if(!b.hasOwnProperty(g_keyRet)){return false}var a=parseInt(b[g_keyRet]);return a==g_errTempForeignPartyRecordNotFound}function addWarningStyle(a){a.removeClass("patch-block-sigma");a.addClass("warning")}function removeWarningStyle(a){a.removeClass("warning");a.addClass("patch-block-sigma")}function getToken(){return getCookie(g_keyToken)}function saveToken(a){setCookie(g_keyToken,a)}function clearToken(){removeCookie(g_keyToken)}function getAccessToken(){return getCookie(g_keyAccessToken)}function getParty(){return getCookie(g_keyParty)}function saveAccessTokenAndParty(b,a){setCookie(g_keyParty,a);setCookie(g_keyAccessToken,b)}function clearAccessTokenAndParty(){removeCookie(g_keyAccessToken);removeCookie(g_keyParty)}function queryCDNDomainSync(){var b=null;var c=getToken();var a=apiCDNDomain(g_cdnQiniu);var d={};d[g_keyToken]=c;$.ajax({type:"POST",url:a,data:d,async:false,success:function(f,e,g){if(isTokenExpired(f)){return null}if(isPlayerNotFound(f)){return null}if(!f.domain){return null}b=f.domain},error:function(g,e,f){return null}});return b}function apiCDNDomain(a){if(a==g_cdnQiniu){return"/image/cdn/qiniu/domain"}return null}var invalid=0;var applied=(1<<0);var selected=(1<<1);var present=(1<<2);var absent=(1<<3);var assessed=(1<<4);var hosted=(1<<5);function Player(a){this.id=parseInt(a.id);this.email=a.email;this.name=a.name;this.avatar=(a.hasOwnProperty("avatar")?a.avatar:"/assets/icons/anonymous.png");this.unreadCount=parseInt(a.unread_count);this.hasAvatar=function(){return !(!this.avatar)};this.groupId=parseInt(a.group_id);this.authenticationStatus=parseInt(a.authentication_status);this.isVisitor=function(){return(!this.groupId||this.groupId===0)};this.hasEmail=function(){return !(!this.email)};this.isEmailAuthenticated=function(){return(!(!this.authenticationStatus)&&((this.authenticationStatus&1)>0))};this.age=a.age;this.gender=a.gender;this.mood=a.mood;this.party=a.party;this.partyNickname=a.party_nickname}function Image(a){this.id=parseInt(a.id);this.url=a.url}function Activity(f){this.id=parseInt(f.id);this.title=f.title;this.address=f.address;this.content=f.content;this.createdTime=parseInt(f.created_time);this.applicationDeadline=parseInt(f.application_deadline);this.isDeadlineExpired=function(){var q=new Date();var p=1000*moment().utcOffset(q.getTimezoneOffset()).unix();return p>this.applicationDeadline};this.beginTime=parseInt(f.begin_time);this.hasBegun=function(){var q=new Date();var p=1000*moment().utcOffset(q.getTimezoneOffset()).unix();return p>this.beginTime};this.capacity=parseInt(f.capacity);this.numApplied=parseInt(f.num_applied);this.numSelected=parseInt(f.num_selected);this.status=parseInt(f.status);this.relation=null;this.containsRelation=function(){return !(!this.relation)};this.relation=parseInt(f.relation);if(f.hasOwnProperty("images")){var k=[];var i=f.images;for(var m in i){var a=i[m];var d=new Image(a);k.push(d)}this.images=k}if(!(!f.applied_participants)){var h=new Array();var c=f.applied_participants;for(var m in c){var j=c[m];var l=new Player(j);h.push(l)}this.appliedParticipants=h}if(!(!f.selected_participants)){var h=[];var c=f.selected_participants;for(var m in c){var j=c[m];var l=new Player(j);h.push(l)}this.selectedParticipants=h}if(!(!f.present_participants)){var h=[];var c=f.present_participants;for(var m in c){var j=c[m];var l=new Player(j);h.push(l)}this.presentParticipants=h}var e=f.host;var o=new Player(e);this.host=o;if(!(!f.viewer)){var b=f.viewer;var g=new Player(b);this.viewer=g}if(!(!f.priority)){this.priority=parseInt(f.priority)}if(!(!f.order_mask)){this.orderMask=parseInt(f.order_mask)}}function Comment(a){this.id=parseInt(a.id);this.content=a.content;this.activityId=parseInt(a.activity_id);if(!(!a.parent_id)){this.parentId=parseInt(a.parent_id)}if(!(!a.predecessor_id)){this.predecessorId=parseInt(a.predecessor_id)}if(!(!a.generated_time)){this.generatedTime=parseInt(a.generated_time)}if(!(!a.num_children)){this.numChildren=parseInt(a.num_children)}if(!(!a.from)){this.from=parseInt(a.from)}if(!(!a.from_player)){this.fromPlayer=new Player(a.from_player)}if(!(!a.to)){this.to=parseInt(a.to)}if(!(!a.to_player)){this.toPlayer=new Player(a.to_player)}}function Assessment(a){this.content=a.content;this.activityId=parseInt(a.activity_id);this.from=parseInt(a.from);this.to=parseInt(a.to);this.fromPlayer=new Player(a.from_player);this.toPlayer=new Player(a.to_player)}function Notification(a){this.id=parseInt(a.id);this.isRead=parseInt(a.is_read);this.from=parseInt(a.from);this.to=parseInt(a.to);this.content=a.content;this.activityId=parseInt(a.activity_id);this.commentId=parseInt(a.comment_id);this.assessmentId=parseInt(a.assessment_id);this.cmd=parseInt(a.cmd);this.relation=parseInt(a.relation);this.status=parseInt(a.status);this.generatedTime=parseInt(a.generated_time)}function BaseWidget(){this.refresh=function(a){if(!this.content){return}this.content.empty();this.composeContent(a)};this.appendTo=function(a){this.content=$("<div>").appendTo(a)};this.show=function(){this.content.show()};this.hide=function(){this.content.hide()};this.remove=function(){this.content.remove()}}function BaseModalWidget(){}BaseModalWidget.inherits(BaseWidget);BaseModalWidget.method("appendTo",function(b,a,c){this.container=$("<div class='modal fade' data-keyboard='false' tabindex='-1' role='dialog' aria-labelledby='create' aria-hidden='true'>").appendTo(b);if(!(!c)){this.container.addClass(c)}if(!(!a)){this.container.attr("data-backdrop","static")}this.dialog=$("<div class='modal-dialog modal-lg'>").appendTo(this.container);this.content=$("<div class='modal-content'>").appendTo(this.dialog)});BaseModalWidget.method("show",function(){this.container.modal("show")});BaseModalWidget.method("hide",function(){this.container.modal("hide")});BaseModalWidget.method("remove",function(){this.container.remove()});var SLOT_IDLE=0;var SLOT_UPLOADING=1;var SLOT_UPLOAD_FAILED=2;var SLOT_AJAX_PENDING=3;var SLOT_UPLOADED=4;function ImageNode(){this.state=SLOT_IDLE;this.uploader=null;this.wrap=null;this.preview=null;this.editor=null;this.btnChoose=null;this.setCDNCredentials=function(a,e,d,c){this.cdn=a;this.bucketDomain=e;var b=currentMillis();this.remoteName="{0}_{1}".format(c.id,b);var f=[g_keyToken+"="+d,g_keyDomain+"="+this.bucketDomain,g_keyRemoteName+"="+this.remoteName];this.uptokenUrl="/image/cdn/qiniu/uptoken?"+f.join("&")}}ImageNode.inherits(BaseWidget);function AjaxButton(f,b,a,c,g,e,d){this.text=f;this.url=b;this.clickData=a;this.type=c;this.extraParams=g;this.onSuccess=e;this.onError=d;this.composeContent=function(h){this.button=$("<button>",{text:this.text}).appendTo(this.content).click(h,function(k){k.preventDefault();var m=k.data.clickData;var o=k.data.url;var j=k.data.type;var p=k.data.extraParams;var i=k.data.onSuccess;var q=k.data.onError;var l=getTarget(k);disableField(l);$.ajax({url:o,type:j,data:p,success:function(s,r,t){enableField(l);if(!i){return}i(s)},error:function(t,r,s){enableField(l);if(!q){return}q(s)}})})}}AjaxButton.inherits(BaseWidget);function DatetimePicker(a){this.input=a;this.getDatetime=function(){var b=this.input.val();if(!b||b===""||b.length===0){return null}return b+":00"}}function generateDatePicker(g,c,h){var b=$("<div>",{}).appendTo(g).on("input change keyup",h);var a=$("<div>",{}).appendTo(b);var d=$("<div>",{"class":"input-group date"}).appendTo(a);var i=$("<input>",{type:"text",value:c,disabled:true,"class":"form-control"}).appendTo(d);var f=$("<span>",{"class":"input-group-addon"}).appendTo(d);var e=$("<span>",{"class":"glyphicon glyphicon-calendar"}).appendTo(f);d.datetimepicker({format:"YYYY-MM-DD HH:mm"});return new DatetimePicker(i)}function PagerFilter(b,a){this.key=b;this.selector=a}function PagerCache(a){this.size=a;this.map={};this.first=1;this.last=1;this.prependPage=function(c){var b=Object.keys(this.map).length;if(this.map.hasOwnProperty(this.last)&&b==this.size){delete this.map[this.last];--this.last}this.map[--this.first]=c};this.appendPage=function(c){var b=Object.keys(this.map).length;if(this.map.hasOwnProperty(this.first)&&b==this.size){delete this.map[this.first];++this.first}this.map[++this.last]=c};this.putPage=function(c,b){if(c>this.last){this.appendPage(b)}else{if(c<this.first){this.prependPage(b)}else{this.map[c]=b}}}}function PagerButton(a,b){this.pager=a;this.page=b}function Pager(h,a,b,g,f,e,d,c){this.init=function(q,i,j,p,o,m,l,k){this.nItems=q;this.page=1;this.total=0;this.st=-g_inf;this.ed=g_inf;this.url=i;this.paramsGenerator=j;this.extraParams=p;this.onSuccess=l;this.onError=k;this.cache=new PagerCache(o);this.filterMap=m};this.refreshFilters=function(){this.filterList=[];if(!this.filterMap){return}for(var u in this.filterMap){var q=this.filterMap[u];var r=q[0];var m=q[1];var o=$("<select>").appendTo(this.filterBar);var l=r.length;for(var p=0;p<l;++p){var s=r[p];var t=m[p];$("<option>",{text:s,value:t}).appendTo(o)}var j=function(w){var v=w.data;var x=v.paramsGenerator(v,1);if(!x){return}var i=k.selector;disableField(i);$.ajax({type:"GET",url:v.url,data:x,success:function(A,y,B){var z=v.cache.size;v.cache=new PagerCache(z);enableField(i);v.onSuccess(A)},error:function(A,y,z){enableField(i);v.onError(z)}})};o.change(this,j);var k=new PagerFilter(u,o);this.filterList.push(k)}};this.createFilters=function(){this.filterBar=$("<div>").appendTo(this.content);this.refreshFilters()};this.refreshBar=function(){var j=this;var m=j.page;var r=j.cache;j.bar.empty();var i=Object.keys(r.map).length;if(i<=1){return}var o=function(t){if(!j.url){return}var s=getTarget(t);var u=t.data;j.page=u.page;var v=j.paramsGenerator(j,u.page);if(!v){return}disableField(s);$.ajax({type:"GET",url:j.url,data:v,success:function(x,w,y){enableField(s);j.onSuccess(x)},error:function(y,w,x){enableField(s);j.onError(x)}})};for(var q in r.map){var l=parseInt(q);var p=$("<button>",{text:l,"class":"plain-button pager-button"}).appendTo(j.bar);var k=new PagerButton(j,l);p.click(k,o);if(l!=m){continue}p.off("mouseenter mouseleave");p.addClass("active-button")}};this.createBar=function(){this.bar=$("<div>").appendTo(this.content);this.refreshBar()};this.refreshScreen=function(i){this.screen.empty();this.updateScreen(i);this.refreshBar()};this.createScreen=function(i){this.screen=$("<div>").appendTo(this.content);this.refreshScreen(i)};this.composeContent=function(i){if(!this.filterBar){this.createFilters()}if(!this.bar){this.createBar()}if(!this.screen){this.createScreen(i)}};this.goToPage=function(j){var i=this;i.page=j;var k=i.paramsGenerator(i,j);if(!k){return}$.ajax({type:"GET",url:i.url,data:k,success:function(m,l,o){i.onSuccess(m)},error:function(o,l,m){i.onError(m)}})}}Pager.inherits(BaseWidget);function Announcement(){this.composeContent=function(b){setDimensions(this.content,"80%","90%");var a=b;var c=$("<div>",{"class":"general-popup-paragraph",text:a}).appendTo(this.content)}}Announcement.inherits(BaseModalWidget);function createBinarySwitch(e,c,d,i,f,b,k){var a=$("<div class='onoffswitch'>").appendTo(e);var h=$("<input type='checkbox' class='onoffswitch-checkbox' id='"+k+"'>").appendTo(a);var g=$("<label class='onoffswitch-label' for='"+k+"'>").appendTo(a);var l=$("<span class='onoffswitch-inner'>").appendTo(g);var j=$("<span class='onoffswitch-switch'>").appendTo(g);l.attr("left-text",f);l.attr("right-text",b);if(c){disableBinarySwitch(a);l.attr("right-text",i);j.hide()}else{j.show()}setBinarySwitch(a,d);return a}function setBinarySwitch(a,c){var b=firstChild(a,"input.onoffswitch-checkbox");b.prop("checked",c)}function setBinarySwitchOnClick(a,c){var b=firstChild(a,"input.onoffswitch-checkbox");if(b.is(":disabled")){return}a.off("click").on("click",c)}function getBinarySwitchState(a){var b=firstChild(a,"input.onoffswitch-checkbox");return b.is(":checked")}function disableBinarySwitch(a){a.off("click");var b=firstChild(a,"input.onoffswitch-checkbox");b.prop("checked",false);disableField(b)}function DropdownMenu(a,b,c){this.toggle=a;this.items=b;this.reactions=c;this.setReactionParams=function(f){this.reactionParams=f;var e=f.length;for(var d=0;d<e;d++){this.items[d].click(f[d],c[d])}}}function createDropdownMenu(k,b,d,o,q,l,h){var c=l.length;if(c!=o.length){return}var a=$("<div>",{"class":"menu-actions"}).appendTo(k);var g=null;var j=$("<ul>",{}).appendTo(a);var p=[];for(var f=0;f<l.length;f++){var m=$("<li class='action-"+q[f]+" patch-block-gamma'>").appendTo(j);var e=$("<a class='patch-block-gamma' tabindex='-1' href='#' title='"+l[f]+"'>").appendTo(m);e.text(l[f]);p.push(m)}return new DropdownMenu(g,p,h)}function NavTab(a){this.panes=a}function createNavTab(h,m,k,q,r,d){var g=$("<ul class='nav nav-pills' role='tablist'>").appendTo(h);var b=m.length;for(var f=0;f<b;f++){var p=null;if(m[f]==q){p=$("<li role='presentation' class='active'>").appendTo(g)}else{p=$("<li role='presentation'>").appendTo(g)}var a=$("<a href='#"+m[f]+"' role='tab' data-toggle='tab'>").appendTo(p);a.text(k[f])}var l=[];for(var e=0;e<b;e++){var o=(m[e]==q);var c=createNavTabPane(r,m[e],o,d[e]);l.push(c)}return new NavTab(l)}function createNavTabPane(b,d,a,c){var e=null;if(a){e=$("<div role ='tabpanel' class='tab-pane fade in active' id='"+d+"'>").appendTo(b)}else{e=$("<div role='tabpanel' class='tab-pane' fade id='"+d+"'>").appendTo(b)}if(!c){return e}e.append(c);return e}function Captcha(a){this.sid=a;this.hasImg=function(){var b=this.img.attr("src");return(!(!b)&&b.length!==0)};this.updateImg=function(){this.img.attr("src","/captcha?"+g_keySid+"="+this.sid+"&ts="+new Date().getTime())};this.composeContent=function(c){var d=$("<div>",{"class":"captcha"}).appendTo(this.content);this.input=$("<input>",{placeHolder:HINTS.captcha}).on("focusin",this,function(e){var f=e.data;if(f.hasImg()){return}f.updateImg()}).appendTo(d);this.img=$("<img>",{src:""}).appendTo(d);var b=$("<button>",{"class":"change"}).appendTo(d);b.click(this,function(e){e.preventDefault();var f=e.data;f.updateImg()})}}Captcha.inherits(BaseWidget);function WordCounter(e,b,a,c,d){this.text=e;this.min=b;this.max=a;this.regex=c;this.violationHint=d;this.update=function(f){this.text=f;this.currentText.text(f.length);if(this.valid()){this.currentText.css("color","gray");this.hintText.text("")}else{this.currentText.css("color","red");this.hintText.text(this.violationHint)}};this.appendCounter=function(f){var g=$("<p>").appendTo(f);this.currentText=$("<span>",{"class":"word-counter-current",text:this.text.length}).appendTo(g);this.maxText=$("<span>",{"class":"word-counter-max",text:"/"+this.max.toString()}).appendTo(g);this.hintText=$("<span>",{"class":"word-counter-violation-hint",text:""}).appendTo(g);this.update(this.text)};this.valid=function(){return(c.test(this.text))}}function RegexInputWidget(){}function SearchWidget(){this.collapse=function(){};this.expand=function(){}}SearchWidget.inherits(BaseWidget);function createSelector(h,f,l,a,m,d,j){if(f.length!=l.length){return}var b=f.length;var g=$("<select>").appendTo(h);for(var e=0;e<b;++e){var k=f[e];var c=l[e];$("<option>",{text:k,value:c}).appendTo(g)}return g}var g_participantsForm=null;var g_aliasApplied=0;var g_aliasSelected=1;var g_tabParticipants=null;function ParticipantsForm(d,e,a,b,c){this.activity=d;this.idList=b;this.labels=e;this.boxes=a;this.relationList=c}function appendParticipantLabels(l,a,c,q,d,f,g,j){if(!q){return}var b=q.length;var k=function(i){i.preventDefault();var t=i.data;window.location.hash=("profile?"+g_keyVieweeId+"="+t.id.toString())};for(var e=0;e<b;++e){var p=q[e];if(a==g_aliasApplied){f.push(p.id)}d.push(a);var s=$("<p>").appendTo(l);var o=$("<label>",{"class":"participant-label"}).appendTo(s);j.push(o);var h=$("<input>",{type:"checkbox","class":"participant-checkbox"}).appendTo(o);g.push(h);if(a==g_aliasSelected){h.hide()}else{if(!c){h.hide()}}var m=$("<img>",{src:p.avatar,"class":"participant-avatar"}).click(p,k).appendTo(o);var r=$("<plaintext>",{"class":"participant-label-name selected-participant title-beta",text:p.name}).appendTo(o)}}function generateParticipantsSelectionForm(k,d){var b=$("<form>",{"class":"participant-form"}).appendTo(k);var l=currentMillis();var c=(!(!g_loggedInPlayer)&&g_loggedInPlayer.id==d.host.id&&l<d.beginTime);var h=[];var g=[];var f=[];var e=[];appendParticipantLabels(b,g_aliasSelected,c,d.selectedParticipants,e,f,g,h);appendParticipantLabels(b,g_aliasApplied,c,d.appliedParticipants,e,f,g,h);var i=new ParticipantsForm(d,h,g,f,e);var j=((!d.appliedParticipants)?0:d.appliedParticipants.length);if(!c||j===0||g.length<=1){return i}var a=$("<button>",{text:TITLES.submit_participant_selection,"class":"positive-button"}).appendTo(b).click(i,function(u){u.preventDefault();var m=u.data;var v=[];for(var r=0;r<m.labels.length;r++){var s=m.boxes[r];if(isHidden(s)||!isChecked(s)){continue}var t=m.idList[r];if(t==m.activity.host.id){continue}v.push(t)}if(v.length===0){return}var o=getToken();if(!o){return}if(v.length+m.activity.numSelected>g_maxSelected){alert(ALERTS.selected_num_exceeded);return}var q={};q[g_keyToken]=o;q[g_keyActivityId]=m.activity.id;q[g_keyBundle]=JSON.stringify(v);var p=getTarget(u);disableField(p);$.ajax({type:"POST",url:"/el/activity/participants/update",data:q,success:function(A,w,B){enableField(p);if(isTokenExpired(A)){logout(null);return}if(isSelectedLimitExceeded(A)){alert(ALERTS.selected_num_exceeded);return}if(!isStandardSuccess(A)){alert(ALERTS.participant_selection_not_submitted);return}for(var y=0;y<m.labels.length;++y){var x=m.labels[y];if(m.relationList[y]==g_aliasSelected){continue}var z=m.boxes[y];if(isHidden(z)||!isChecked(z)){continue}x.removeClass("applied-participant");x.addClass("selected-participant title-beta");z.hide();m.relationList[y]=g_aliasSelected}},error:function(y,w,x){enableField(p)}})});$("<hr>").appendTo(b);return i}var g_redirectCounter=null;var g_redirectCountDown=0;function redirectTimer(b,a){g_redirectCountDown=g_redirectCountDown-1;if(g_redirectCountDown<=0){clearInterval(g_redirectCounter);window.location="/";return}$("#content").html(MESSAGES.email_verification_success.format(b,a,g_redirectCountDown))}function routeByHash(){var c=window.location.href;var b=extractTagAndParams(c);if(b==null){return}var a=b.tag;var d=b.params;if(a==null||a==""){return}if(a=="success"){g_redirectCountDown=5;g_redirectCounter=setInterval(redirectTimer,1000,d[g_keyName],d[g_keyEmail]);return}if(a=="failure"){$("#content").html(MESSAGES.email_verification_failure.format(d[g_keyName],d[g_keyEmail],g_adminEmail));return}}$(document).ready(function(){$(window).on("hashchange",function(a){routeByHash()});routeByHash()});